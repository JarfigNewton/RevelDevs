<div class="booyah-box col-10 offset-1">
  <h2><%= @game.name %></h2>
</div>
<head>
    <meta charset="UTF-8">
</head>

<body>
  <div class="chessboard">

    <% for row in (1..8) %> <!-- loops through the rows in the gameboard -->
      <% for col in (1..8) %> <!-- loops through the columns -->
        <div class="square"
           data-x=<%= "#{col}" %>
           data-y=<%= "#{9 - row}" %>
           <% piece = @game.pieces.active.find_by( { x: col , y: 9 - row } ) %>
           data-piece-id=
           <% if piece != nil %>
             "<%= piece.id %>"
           <% end %>
           >
          <div class=
          <% if row % 2 != 0 %>
            <%= col % 2 != 0 ? "black" : "white" %>
          <% else %>
            <%= col % 2 == 0 ? "black" : "white" %>
          <% end %>
          >
            <% if piece != nil %>
              <%= "#{piece.color} #{piece.type}" %>
            <% end %>
          <!-- end of div loop for determining square color -->
          </div>
        </div>
      <% end %>
    <% end %>
  </div>
</body>

<script>
  $(function() {
    var square = $('.square');

    square.click( function() {
      var xPosition = $(this).data('x');
      var yPosition = $(this).data('y');
      var isPieceSelected = square.hasClass('selected');
      var selectedSquareWhite = $('.selected .white');
      var selectedSquareBlack = $('.selected .black');
      var selectedPiece = $('.selected').data('piece-id');

      if (isPieceSelected && !($('.selected').data('x') === xPosition && $('.selected').data('y') === yPosition)) {
        updatePiece();
      }

      if (!isPieceSelected && $(this).data('piece-id')) {
        $(this).addClass('selected');
        var selectedSquareWhite = $('.selected .white');
        var selectedSquareBlack = $('.selected .black');
        selectedSquareWhite.css('font-weight', 'bold');
        selectedSquareBlack.css('font-weight', 'bold');
        selectedSquareWhite.css('background', 'yellow');
        selectedSquareBlack.css('background', 'yellow');
      }
      else {
        $(this).removeClass('selected');
        selectedSquareWhite.css('font-weight', 'normal');
        selectedSquareBlack.css('font-weight', 'normal');
        selectedSquareWhite.css('background', '#fff');
        selectedSquareBlack.css('background', '#999');
      }

      function updatePiece() {
        $.ajax({
          type: 'PATCH',
          url: '/pieces/' + selectedPiece,
          data: { piece: { x: xPosition, y: yPosition } },
          success: function(){
            location.reload();
          }
        });
      }
    });
  });
</script>